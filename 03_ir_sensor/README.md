# IR 센서(근접/반사형) - SIG/VCC/GND (ESP32 GPIO26)

> ✅현재 사용 중인 IR 센서는 “흰/검 라인 구분”보다는 **물체가 가까운지(반사광이 충분한지)**를 더 잘 보여주는 **근접/반사형 IR 센서처럼 동작**합니다.
---
## 실습 목표
IR 센서의 출력(SIG)을 **ESP32 GPIO26**에서 읽어서,
- (1) 센서 값이 어떻게 변하는지 확인하고
- (2) 임계값으로 **감지/미감지(ON/OFF)** 를 만들고
- (3) 오작동을 줄이는 **필터링(히스테리시스/평균)** 을 적용한다.

---

## 1) 준비물
- ESP32(DevKit)
- IR 센서 모듈 (핀 3개: **SIG / VCC / GND**)
- 점퍼선
- 브레드보드

(선택)
- Arduino Nano (아날로그 값 비교 테스트용)

---

## 2) 핀맵 / 배선

### (A) ESP32 배선 (권장)
| IR 센서 핀 | ESP32 | 설명 |
|---|---|---|
| **VCC** | **3V3** | 전원 (+) |
| **GND** | **GND** | 접지 (-) |
| **SIG** | **GPIO26** | 센서 출력(아날로그처럼 변할 수 있음) |

> **중요(공통 접지):** VCC/GND를 정확히 연결해야 값이 안정적으로 나옵니다.

### (B) Arduino Nano로 테스트할 때(참고)
| IR 센서 핀 | Arduino Nano | 설명 |
|---|---|---|
| **VCC** | **5V** | 전원 (+) |
| **GND** | **GND** | 접지 (-) |
| **SIG** | **A0** | `analogRead()`로 값 확인 |

---

## 3) 이 센서가 “라인(흰/검)”이 아니라 “근접”처럼 보이는 이유

### ✅ 관측한 패턴
- 물체가 가까우면: **값이 크게 올라가고 (예: ESP32에서 3000~3600 근처)**
- 멀어지면: **0 근처로 떨어짐**
- 검은선을 밟아도: 상황에 따라 **높은 값이 유지될 수 있음**

### ✅ 해석
이건 보통 아래 중 하나(또는 복합)입니다.
1. 센서가 바닥의 “흰/검 차이”보다 **거리(반사량 크기)**에 더 민감
2. 센서가 보는 방향/각도가 바닥이 아니라 **앞/옆 물체 반사**에 더 민감
3. 출력(SIG)이 연속값처럼 보이더라도 내부 회로 특성상 **0 또는 큰 값 위주로 뭉칠 수 있음**

---

## 4) 코드 파일 목록 (추천)
- **실습 1:** `lab1_ir_read_value_esp32.py` (ESP32에서 값 읽기)
- **실습 2:** `lab2_ir_threshold_onoff_esp32.py` (임계값으로 ON/OFF)
- **실습 3:** `lab3_ir_filter_hysteresis_esp32.py` (필터링/히스테리시스)

---

# 실습) IR 값 읽기 (ESP32)

## 1) 코드 전체 흐름(큰 그림)
- `read_u16()` 또는 `read()`로 값 읽기
- 시리얼(Thonny)에서 값 변화 관찰

## 2) 주요 코드
> 파일: `lab_ir_read_value_esp32.py`

    from machine import Pin
    import time

    IR_PIN = 26
    ir = Pin(IR_PIN, Pin.IN)

    print("[실습1] IR 디지털 값 읽기 시작 (반전 출력)")
    print("출력 기준: 검은색=0, 흰색=1")

    while True:
        raw = ir.value()      # 원래 센서 출력 (검은색=1, 흰색=0)
        print("IR =", raw)    
        # 값을 반대로 출력하고 싶다면 , val = 1- raw , print("IR =", val) 으로 추가/변경 해주세요!
    
    time.sleep(0.1)

### 체크 포인트
- 값이 계속 **0**이면: VCC/GND 배선, SIG 배선, 핀 번호(GPIO26)부터 확인
- 값이 계속 **최대치에 가깝게 고정**이면: 센서가 너무 가까운 물체를 보고 있거나, SIG가 3.3V에 가까운 HIGH로 붙어있을 수 있음


## 6) 자주 막히는 곳(트러블슈팅)

### (1) 검은선인데도 값이 높게 나와요
- 검은선 일 때 높은 값으로 출력되도록 내부 설정이 되어 있을 수 있습니다.
- 센서 높이를 조금 올리거나(바닥에서 멀리)
- 센서 각도를 바닥에 수직으로 맞추고
- 주변(옆/앞)에 반사되는 물체(손/벽/테이블 가장자리)가 없는지 확인하세요.

### (2) 값이 0 또는 최대치로만 나와요
- SIG가 **디지털 판정 출력**에 가까운 경우일 수 있습니다.
- 그럴 땐 실습2/3처럼 **threshold 기반 ON/OFF**로 쓰는 게 정석입니다.

### (3) ESP32에서 값 범위가 0~3600 정도로 보여요
- ESP32의 ADC는 12-bit일 때 보통 0~4095 범위입니다.
- 3600대는 “상당히 높은 입력(강한 반사/가까움)”이라는 뜻으로 이해하면 됩니다.

---

## 7) 다음 확장 아이디어(수업용)
- 감지되면 LED 켜기
- 감지되면 모터 정지(L9110S 실습과 연결)
- 두 개 센서를 좌/우에 붙여서 간단한 장애물 회피/라인트레이서 형태로 확장

---

## 라이선스(선택)
수업 자료로 자유롭게 사용하려면 아래처럼 넣어도 됩니다.
- MIT License 또는 CC BY

