# 가스 센서(MQ Sensor 모듈) - VCC / D0 / A0 / GND (D0=GPIO26, A0=GPIO25)

ESP32(MicroPython/Thonny)로 **MQ 계열 가스 센서 모듈(MQ-2/MQ-3/MQ-135 등)**을 다루는 실습 자료입니다.

> MQ 센서는 종류에 따라 감지 대상이 달라요. 하지만 **모듈 핀(VCC, GND, D0, A0)**과 사용 방법은 거의 같습니다.

---

## 0) 이 실습의 한 줄 목표
- **D0(디지털 출력)**: “임계값 넘음/안 넘음”을 0/1로 읽어 **가스 감지 알림** 만들기
- **A0(아날로그 출력)**: 가스 농도 변화를 **숫자(0~4095)**로 읽어 **그래프/추세** 관찰하기

---

## 1) 준비물
- ESP32 DevKit (MicroPython 설치)
- MQ 가스 센서 모듈(핀: **VCC, GND, D0, A0**)
- 점퍼선
- 브레드보드(선택)
- (권장) **저항 2개**(예: 20kΩ + 10kΩ) → 5V 출력일 때 전압분배용

---

## 2) 배선 (핀 지정: D0=GPIO26, A0=GPIO25)

### (A) 가장 안전한 기본 원칙(중요)
- ESP32의 GPIO/ADC는 **최대 3.3V**까지만 안전합니다.
- MQ 모듈을 **5V로 구동**하면, **D0/A0가 5V까지 나올 수 있는 제품이 많습니다.**
  - 이 경우 **전압분배(레벨시프팅)** 없이 바로 GPIO/ADC에 연결하면 ESP32가 손상될 수 있어요.

따라서 아래 중 하나로 하세요.

### 옵션 1) VCC를 3V3에 연결(쉬운 실습용)
- 모듈 **VCC → ESP32 3V3**
- 모듈 **GND → ESP32 GND**
- 모듈 **D0 → ESP32 GPIO26**
- 모듈 **A0 → ESP32 GPIO25(ADC)**

> 장점: 회로가 단순하고 3.3V 안전
>
> 주의: MQ 센서는 원래 히터가 필요해서, 3.3V에서는 반응이 약하거나 느릴 수 있어요(실습/데모는 가능).

### 옵션 2) VCC를 5V(VIN)에 연결(반응이 더 좋은 편)
- 모듈 **VCC → ESP32 VIN(5V)** *(또는 외부 5V)*
- 모듈 **GND → ESP32 GND** *(공통 접지 필수)*
- 모듈 **D0 → (전압분배 후) → ESP32 GPIO26**
- 모듈 **A0 → (전압분배 후) → ESP32 GPIO25(ADC)**

**전압분배 예시(5V → 약 3.3V로):**
- 위(R1)=20kΩ, 아래(R2)=10kΩ
- 출력 = 5V × (R2/(R1+R2)) = 5 × (10/(20+10)) ≈ **3.33V**

---

## 3) 회로 연결표 (MQ 모듈 ↔ ESP32)

| 연결 목적 | 출발(부품/핀) | 도착(부품/핀) | 설명(한 줄) |
|---|---|---|---|
| 전원 공급 | MQ VCC | ESP32 3V3 *(또는 VIN 5V)* | 센서 모듈 전원 |
| 공통 접지(필수) | MQ GND | ESP32 GND | 기준점 공유(안 하면 오작동) |
| 디지털 감지 | MQ D0 | ESP32 GPIO26 | 임계값 넘으면 0/1 출력 |
| 아날로그 값 | MQ A0 | ESP32 GPIO25(ADC) | 가스 농도 변화(연속값) |

---

## 4) 핀(D0 / A0) 의미를 한 줄로 이해하기
- **D0 (Digital Out)**: 모듈의 비교기(LM393)가 “가스 많다/적다”를 **0 또는 1**로 바꿔서 출력
  - 보드에 가변저항(파란 트리머)이 있으면, 그걸로 **임계값**을 조절할 수 있습니다.
- **A0 (Analog Out)**: 센서에서 나온 신호를 **연속값 전압**으로 출력(가스 농도에 따라 값이 변함)

---

## 5) 코드 파일 목록(추천)
- **실습 1:** `lab1_mq_do_digital_alarm.py` (D0로 감지 알림)
- **실습 2:** `lab2_mq_ao_analog_read.py` (A0 아날로그 값 읽기)
- **실습 3:** `lab3_mq_do_ao_combo.py` (D0 + A0 같이 보기)

---

# 실습 1) D0로 “가스 감지” 알림 만들기

## 1) 코드 전체 흐름(큰 그림)
- GPIO26을 입력으로 설정
- 0/1 값을 읽어서 상태 출력

## 2) 코드
```python
from machine import Pin
import time

DO = Pin(26, Pin.IN)   # D0=GPIO26

print("[실습1] MQ D0 디지털 감지")
while True:
    v = DO.value()  # 0 또는 1

    # 모듈마다 논리가 반대일 수 있어요.
    # 일반적으로: 감지되면 0(LOW)로 떨어지는 제품이 많습니다.
    if v == 0:
        print("GAS DETECTED! (D0=0)")
    else:
        print("Normal (D0=1)")

    time.sleep(0.3)
```

## 3) 체크 포인트
- 감지 논리(0/1)가 반대면 **조건문만 바꾸면 됩니다.**
- D0가 계속 0이나 1로 고정이면
  - (1) 배선 확인
  - (2) 모듈 트리머(가변저항)가 있다면 임계값 조정
  - (3) 센서 예열이 덜 됐을 수 있음(아래 참고)

---

# 실습 2) A0 아날로그 값 읽기(0~4095)

## 1) 코드 전체 흐름
- GPIO25를 ADC 입력으로 설정
- `read()`로 0~4095 값을 읽어 출력

## 2) 코드
```python
from machine import ADC, Pin
import time

adc = ADC(Pin(25))        # A0=GPIO25
adc.atten(ADC.ATTN_11DB)  # 측정 전압 범위 확장(ESP32에서 자주 사용)
adc.width(ADC.WIDTH_12BIT)

print("[실습2] MQ A0 아날로그 읽기")
while True:
    val = adc.read()  # 0~4095
    print("AO:", val)
    time.sleep(0.2)
```

## 3) 체크 포인트
- **A0가 5V까지 나올 수 있는 모듈**이면 반드시 전압분배 후 ESP32 ADC에 넣으세요.
- 값이 천천히 변하는 건 정상입니다(센서 반응 + 예열 + 공기 흐름 영향).

---

# 실습 3) D0 + A0 동시에 보기

## 1) 코드 전체 흐름
- D0(0/1)와 A0(0~4095)를 같이 출력해서 “임계값이 어디쯤인지” 감 잡기

## 2) 코드
```python
from machine import Pin, ADC
import time

DO = Pin(26, Pin.IN)
adc = ADC(Pin(25))
adc.atten(ADC.ATTN_11DB)
adc.width(ADC.WIDTH_12BIT)

print("[실습3] MQ D0 + A0 함께 보기")
while True:
    d = DO.value()
    a = adc.read()
    print("D0:", d, " | A0:", a)
    time.sleep(0.3)
```

---

## 6) 센서 예열(아주 중요)
- MQ 센서는 내부 히터가 있어 **처음 켠 뒤 값이 안정되기까지 시간이 필요**합니다.
- 수업/데모용으로는 **1~3분 정도** 기다리면 변화가 좀 더 안정적으로 보입니다.
- 정밀 측정(실제 농도 추정)은 훨씬 더 긴 안정화가 필요할 수 있어요.

---

## 7) 확장 아이디어(선택)
- A0 값을 시간에 따라 기록해서 **그래프(Excel/Google Sheets)**로 시각화
- D0 감지 시 LED/부저를 켜서 경보 장치 만들기
- 여러 센서(DHT11 + MQ)를 같이 사용해 “온습도에 따른 가스값 변화” 관찰

